<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/product-filter.css}">
</head>

<body>
<nav class="navbar">
    <div class="navbar-left">
        <a href="/" class="nav-brand">ArtisanCoffee</a>
    </div>

    <div class="navbar-right">
        <div class="dropdown" sec:authorize="isAuthenticated()">
            <button class="dropbtn" sec:authentication="name"></button>
            <div class="dropdown-content">
                <form th:if="${#authorization.expression('hasRole(''ADMIN'')')}" action="/h2-console" method="get" target="_blank" style="margin-bottom: 8px;">
                    <button type="submit" class="admin-btn">H2 Console</button>
                </form>

                <form th:action="@{/admin}" method="get" sec:authorize="hasRole('ADMIN')">
                    <button type="submit" class="admin-btn">Admin Panel</button>
                </form>

                <form action="/logout" method="post" style="display:none;" id="logoutForm">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                </form>
                <button type="button" class="logout-btn" onclick="document.getElementById('logoutForm').submit()">Logout</button>
            </div>
        </div>
        <a sec:authorize="!isAuthenticated()" href="/login" class="login-btn">Login</a>
    </div>
</nav>

<main>
    <div class="product-container">
    <form class="filter-bar" th:action="@{/}" method="get">
        <input type="text" name="name" placeholder="Search by name" th:value="${name}">

        <select name="category" th:value="${category}">
            <option value="">All Categories</option>
            <option th:each="cat : ${categories}" th:value="${cat}" th:text="${cat}"></option>
        </select>

        <input type="number" name="minPrice" placeholder="Min Price" th:value="${minPrice}">
        <input type="number" name="maxPrice" placeholder="Max Price" th:value="${maxPrice}">

        <label>
            <input type="checkbox" name="inStockOnly" th:checked="${inStockOnly == true}"> In Stock
        </label>

        <button type="submit">Filter</button>
    </form>

        <div class="product-list">
            <div th:each="product : ${products}" class="product-card"
                 th:attr="data-id=${product.id}" onclick="showProductDetails(this)">
                <img th:if="${product.imageUrl != null}"
                     th:src="@{/uploads/{filename}(filename=${product.imageUrl})}"
                     alt="Product image" style="max-width:300px;"/><br/>
                <h3 th:text="${product.name}">Product Name</h3>
                <p th:text="${product.price} + 'â‚¬'">Price</p><br/><br/>
            </div>
        </div>

        <div id="productModal" style="display:none; position:fixed; top:50%; left:50%;
    transform:translate(-50%, -50%); background:white; padding:20px; border:1px solid black;">
            <button onclick="closeModal()">X</button>
            <img id="modalImage" style="max-width:300px;"/>
            <h3 id="modalName"></h3>
            <p id="modalPrice"></p>
            <p id="modalCategory"></p>
            <p id="modalDescription"></p>
            <p id="modalQuantity"></p>
        </div>
    </div>

</main>
<script src="/js/home.js"></script>
</body>
</html>