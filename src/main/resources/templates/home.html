<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/product-filter.css}">
</head>
<body>
<header th:replace="~{fragments/navbar :: navbar}"></header>

<main>
    <form class="filter-bar" th:action="@{/}" method="get">
        <input type="text" name="name" placeholder="Search by name" th:value="${name}">
        <select name="category" th:value="${category}">
            <option value="">All Categories</option>
            <option th:each="cat : ${categories}" th:value="${cat}" th:text="${cat}"></option>
        </select>
        <input type="number" name="minPrice" placeholder="Min Price" th:value="${minPrice}">
        <input type="number" name="maxPrice" placeholder="Max Price" th:value="${maxPrice}">
        <label style="display: flex; align-items: center; gap: 5px;">
            <input type="checkbox" name="inStockOnly" th:checked="${inStockOnly == true}"> In Stock
        </label>
        <button type="submit">Filter</button>
    </form>

    <div class="product-list">
        <div th:each="product : ${products}" class="product-card" th:attr="data-id=${product.id}" onclick="showProductDetails(this)" style="position: relative;">
            <img th:if="${product.imageUrl != null}" th:src="@{/uploads/{filename}(filename=${product.imageUrl})}" alt="Product image"/>
            <div th:if="${product.quantity == 0}" class="out-of-stock">Out of Stock</div>
            <h3 th:text="${product.name}">Product Name</h3>
            <p th:text="${product.price} + '€'">Price</p>
        </div>
    </div>

    <div id="productModal" class="modal">
        <button class="close-btn" onclick="closeModal()">✕</button>

        <div class="modal-layout">
            <div class="modal-top-row">
                <div class="modal-left">
                    <img id="modalImage" alt="Product image">
                </div>

                <div class="modal-right">
                    <h3 id="modalName"></h3>
                    <p id="modalPrice"></p>
                    <p id="modalCategory"></p>
                </div>
            </div>

            <div class="modal-description">
                <p id="modalDescription"></p>
            </div>

            <div class="modal-left-under">
                <p id="modalQuantity"></p>
                <form id="cartForm" method="post">
                    <input type="number" name="quantity" value="1" min="1">
                    <input type="hidden" name="_csrf" th:value="${_csrf.token}" th:name="${_csrf.parameterName}" />
                    <button type="submit">Add to Cart</button>
                </form>
            </div>
        </div>
    </div>
</main>

<script src="/js/home.js"></script>
</body>
</html>